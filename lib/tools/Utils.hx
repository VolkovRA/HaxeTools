package tools;

import js.Browser;
import js.html.Blob;
import js.html.URL;

/**
 * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã. üî®  
 * –ö–ª–∞—Å—Å —Å–æ–¥–µ—Ä–∂–∏—Ç —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–µ—Ç–æ–¥—ã –∏
 * —Ñ—É–Ω–∫—Ü–∏–π –æ–±—â–µ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –ø–∏—Å–∞—Ç—å
 * –∏—Ö –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–Ω–æ–≥–æ.
 * 
 * –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å.
 */
@:dce
class Utils
{
    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞: `null`  
     * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∫—Ä–∞—Ç–∫–∞—è —Ñ–æ—Ä–º–∞ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
     * –Ω–∞: `null` —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —É–∫–∞–∑–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ
     * —É–º–æ–ª—á–∞–Ω–∏—é.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `value`, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–≤–Ω–æ: `null`
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `def` –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö.
     * @param value –ü—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
     * @param def –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
     * @return –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
     */
    inline static public function nvl(value:Dynamic, def:Dynamic):Dynamic {
        return value==null?def:value;
    }

    /**
     * –û–∫—Ä—É–≥–ª–∏—Ç—å —á–∏—Å–ª–æ —Å –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é.  
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —á–∏—Å–ª–æ —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ —É–∫–∞–∑–∞–Ω–Ω–æ–π
     * —Ç–æ—á–∫–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * Utils.round(0, 0);           // 0
     * Utils.round(10, 0);          // 10
     * Utils.round(10.1234567, 0);  // 10
     * Utils.round(10.1234567, 1);  // 10.1
     * Utils.round(10.1234567, 2);  // 10.12
     * Utils.round(10.1234567, 3);  // 10.123
     * Utils.round(10.1234567, 4);  // 10.1235
     * Utils.round(10.1234567, 5);  // 10.12346
     * Utils.round(10.1234567, 6);  // 10.123457
     * Utils.round(10.1234567, 10); // 10.1234567
     * ```
     * @param value –û–∫—Ä—É–≥–ª—è–µ–º–æ–µ —á–∏—Å–ª–æ.
     * @param n –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.
     * @return –û–∫—Ä—É–≥–ª—ë–Ω–Ω–æ–µ —á–∏—Å–ª–æ –∑–∞–¥–∞–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏.
     */
    static public function round(value:Float, n:Int):Float {
        var m:Float = Math.pow(10, n);
        return Math.round(value*m)/m;
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –≤ —á–∏—Å–ª–µ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.  
     * –ü–∞—Ä—Å–∏—Ç —á–∏—Å–ª–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ
     * –∑–∞–ø—è—Ç–æ–π.
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * Utils.dec(0);     // 0
     * Utils.dec(0.1);   // 1
     * Utils.dec(0.12);  // 2
     * Utils.dec(0.123); // 3
     * ```
     * @param value –ò—Å—Ö–æ–¥–Ω–æ–µ —á–∏—Å–ª–æ.
     * @return –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.
     */
    static public function dec(value:Float):Int {
        var v:String = value + "";
        var i:Int = v.indexOf(".");
        if (i == -1)
            return 0;
        return v.length-i-1;
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞–∫ —á–∏—Å–ª–∞.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `1`, –µ—Å–ª–∏ —á–∏—Å–ª–æ –±–æ–ª—å—à–µ –Ω—É–ª—è.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `-1`, –µ—Å–ª–∏ —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ –Ω—É–ª—è.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `0` –≤–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö.
     * @param value –ß–∏—Å–ª–æ.
     * @return –ó–Ω–∞–∫ —á–∏—Å–ª–∞.
     */
    static public function sign(value:Float):Int {
        if (value > 0)
            return 1;
        if (value < 0)
            return -1;
        return 0;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–ª–∞–≥–æ–≤ –≤ –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–µ.  
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `true`, –µ—Å–ª–∏ –º–∞—Å–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ
     *   —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `false`, –µ—Å–ª–∏ –º–∞—Å–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç
     *   —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ –∏–∑ —Ñ–ª–∞–≥–æ–≤.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `true`, –µ—Å–ª–∏ —Ñ–ª–∞–≥–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã.
     *   (`flags=0`)
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * Utils.maskAND(10, 0);   // true:  01010, 00000
     * Utils.maskAND(10, 10);  // true:  01010, 01010
     * Utils.maskAND(21, 4);   // true:  10101, 00100
     * Utils.maskAND(10, 512); // false: 01010, 01000
     * Utils.maskAND(10, 4);   // false: 01010, 00100
     * ```
     * 
     * **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ**, –≤ JavaScript –ø–æ–±–∏—Ç–æ–≤—ã–µ
     * –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–æ —á–∏—Å–ª–∞:
     * `2147483647`, —ç—Ç–æ:
     * `0b1111111111111111111111111111111` –∏–ª–∏:
     * `0x7fffffff`, –∏–ª–∏: `2^31 -1`. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ
     * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∏—Å–ª–æ –±–æ–ª—å—à–µ —ç—Ç–æ–≥–æ, —Ç–∞–∫ –∫–∞–∫
     * –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–Ω–∞–∫–∞ –º–∏–Ω—É—Å.
     * 
     * @param mask –ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞.
     * @param flags –§–ª–∞–≥–∏.
     * @return –ú–∞—Å–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ñ–ª–∞–≥–∏.
     */
    inline static public function maskAND(mask:Int, flags:Int):Bool {
        return (mask&flags)==flags;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ, –∫–∞–∫ –º–∏–Ω–∏–º—É–º, –æ–¥–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞
     * –≤ –±–∏—Ç–æ–≤–æ–π –º–∞—Å–∫–µ.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `true`, –µ—Å–ª–∏ –º–∞—Å–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `false`, –µ—Å–ª–∏ –º–∞—Å–∫–∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ñ–ª–∞–≥–∞.
     * - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `false`, –µ—Å–ª–∏ —Ñ–ª–∞–≥–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω—ã. (`flags=0`)
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * Utils.maskOR(0, 0);    // false: 00000 00000
     * Utils.maskOR(0, 1);    // false: 00000 00001
     * Utils.maskOR(21, 0);   // false: 10101 00000
     * Utils.maskOR(21, 512); // false: 10101 01000
     * Utils.maskOR(21, 4);   // true:  10101 00100
     * ```
     * 
     * **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ**, –≤ JavaScript –ø–æ–±–∏—Ç–æ–≤—ã–µ
     * –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–æ—Ä–º–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –¥–æ —á–∏—Å–ª–∞:
     * `2147483647`, —ç—Ç–æ:
     * `0b1111111111111111111111111111111` –∏–ª–∏:
     * `0x7fffffff`, –∏–ª–∏: `2^31 -1`. –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ
     * –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∏—Å–ª–æ –±–æ–ª—å—à–µ —ç—Ç–æ–≥–æ, —Ç–∞–∫ –∫–∞–∫
     * –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–Ω–∞–∫–∞ –º–∏–Ω—É—Å.
     * 
     * @param mask –ë–∏—Ç–æ–≤–∞—è –º–∞—Å–∫–∞.
     * @param flags –§–ª–∞–≥–∏.
     * @return –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–∞—Å–∫–∏ –∏ —Ñ–ª–∞–≥–æ–≤.
     */
    inline static public function maskOR(mask:Int, flags:Int):Bool {
        return (mask&flags)>0;
    }

    /**
     * –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Ä–∞–¥–∏–∞–Ω—ã –≤ –≥—Ä–∞–¥—É—Å—ã.
     * @param rad –†–∞–¥–∏–∞–Ω—ã.
     * @return –ì—Ä–∞–¥—É—Å—ã.
     */
    inline static public function radToDeg(rad:Float):Float {
        return rad * 57.29577951308232; // rad * (180 / Math.PI);
    }

    /**
     * –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –≥—Ä–∞–¥—É—Å—ã –≤ —Ä–∞–¥–∏–∞–Ω—ã.
     * @param deg –ì—Ä–∞–¥—É—Å—ã.
     * @return –†–∞–¥–∏–∞–Ω—ã.
     */
    inline static public function degToRad(deg:Float):Float {
        return deg * 0.017453292519943295; // deg * (Math.PI / 180);
    }

    /**
     * –ü—Ä–∏–¥—É–º–∞—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å.  
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ
     * –Ω–∞–±–æ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–ª—É—á–∞–π–Ω–æ–π –¥–ª–∏–Ω—ã.
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * var chars = ['1', '2', 'a', 'b', 'c', 'A', 'B', 'C'];
     * Utils.pswdGet(a, 5, 10);   // cCacCCBab
     * Utils.pswdGet(a, 5, 10);   // cB2ccbCC1C
     * Utils.pswdGet(a, 5, 10);   // 2Ca1cb1cb
     * Utils.pswdGet(a, 5, 10);   // 11BBB
     * Utils.pswdGet(a, 10, 10);  // AbbAABbBbc
     * Utils.pswdGet(a, 10, 10);  // aACC22A2CA
     * Utils.pswdGet(a, 10, 10);  // 2bAcbcab2c
     * Utils.pswdGet(a, 10, 0);   // 1ACCbAbCCa
     * Utils.pswdGet(a, 10, 0);   // a11bCacbba
     * ```
     * @param chars –¢–∞–±–ª–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –ø—Ä–∏
     *              –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è.
     * @param lenMin –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è.
     * @param lenMax –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–∞—Ä–æ–ª—è.
     * @return –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å.
     */
    static public function pswdGet(chars:Array<String>, lenMin:Int, lenMax:Int):String {
        var l = chars.length;
        if (lenMin <= 0)
            return "";

        var i = lenMin + Math.round(Math.random() * Math.max(0, lenMax-lenMin));
        var p = "";
        while (i-- > 0)
            p += chars[Math.floor(Math.random()*l)];

        return p;
    }

    /**
     * –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –ø–∞—Ä–æ–ª—å –∑–≤—ë–∑–¥–æ—á–∫–∞–º–∏.  
     * –í—ã–≤–æ–¥–∏—Ç –ø–∞—Ä–æ–ª—å, —Å–∫—Ä—ã–≤–∞—è –µ–≥–æ —Å–∏–º–≤–æ–ª—ã.
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
     * Utils.pswdPrint("123"); // ***
     * ```
     * 
     * **–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ**, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ
     * –ø–∞—Ä–æ–ª—å —Å–∫—Ä—ã—Ç, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –Ω—ë–º
     * –∏–∑–≤–µ—Å—Ç–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é.
     * 
     * @param pswd –ü–∞—Ä–æ–ª—å.
     * @param char –°–∏–º–≤–æ–ª, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –ø–∞—Ä–æ–ª—è.
     * @return –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ –≤–∏–¥–µ —Å–∏–º–≤–æ–ª–æ–≤.
     */
    static public function pswdPrint(pswd:String, char:String = "*"):String {
        var l = pswd.length;
        if (l == 0)
            return "";

        var p = "";
        while (l-- > 0)
            p += char;

        return p;
    }

    /**
     * –ü–æ–ª—É—á–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—ä—ë–º–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.  
     * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
     * –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Å –≥–æ—Å—Ç–æ–º: `8.417‚Äî2002`
     * 
     * –ü—Ä–∏–º–µ—Ä:
     * ```
	 * Utils.size(0);          // 0 bytes
     * Utils.size(100);        // 100 bytes
     * Utils.size(1000);       // 1 KB
     * Utils.size(1024);       // 1.02 KB
     * Utils.size(10000000);   // 10 MB  
     * ```
     * @param bytes –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç.
     * @return –°—Ç—Ä–æ–∫–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
     */
    static public function size(bytes:Int):String {

        // –¢–∞–±–ª–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:
        // https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B3%D0%B0%D0%B1%D0%B0%D0%B9%D1%82
        // 	
        // +------------------------------+
        // |        –ì–û–°–¢ 8.417‚Äî2002       |            
        // | –ù–∞–∑–≤–∞–Ω–∏–µ –û–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ –°—Ç–µ–ø–µ–Ω—å |	
        // +------------------------------+
        // | –±–∞–π—Ç        –ë         10^0   |
        // | –∫–∏–ª–æ–±–∞–π—Ç    –ö–±–∞–π—Ç     10^3   |
        // | –º–µ–≥–∞–±–∞–π—Ç    –ú–±–∞–π—Ç     10^6   |
        // | –≥–∏–≥–∞–±–∞–π—Ç    –ì–±–∞–π—Ç     10^9   |
        // | —Ç–µ—Ä–∞–±–∞–π—Ç    –¢–±–∞–π—Ç     10^12  |
        // | –ø–µ—Ç–∞–±–∞–π—Ç    –ü–±–∞–π—Ç     10^15  |
        // | —ç–∫—Å–∞–±–∞–π—Ç    –≠–±–∞–π—Ç     10^18  |
        // | –∑–µ—Ç—Ç–∞–±–∞–π—Ç   –ó–±–∞–π—Ç     10^21  |
        // | –π–æ—Ç—Ç–∞–±–∞–π—Ç   –ò–±–∞–π—Ç     10^24  |
        // +------------------------------+

        if (bytes < 1e3)		return bytes + " bytes";
        if (bytes < 1e6)		return Math.floor(bytes / 1e1) / 1e2 + " KB";
        if (bytes < 1e9)		return Math.floor(bytes / 1e4) / 1e2 + " MB";
        if (bytes < 1e12)		return Math.floor(bytes / 1e7) / 1e2 + " GB";
        if (bytes < 1e15)		return Math.floor(bytes / 1e10) / 1e2 + " TB";
        if (bytes < 1e18)		return Math.floor(bytes / 1e13) / 1e2 + " PB";
        if (bytes < 1e21)		return Math.floor(bytes / 1e16) / 1e2 + " EB";
        if (bytes < 1e24)		return Math.floor(bytes / 1e19) / 1e2 + " ZB";

        return Math.floor(bytes / 1e22) / 1e2 + " YB";
    }

    /**
     * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª.  
     * –í—ã–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–∞
     * –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π, —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
     * @param data –î–∞–Ω–Ω—ã–µ.
     * @param name –ò–º—è —Ñ–∞–π–ª–∞.
     * @param type –¢–∏–ø —Ñ–∞–π–ª–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä: `text/plain`,
     *             `image/png`, `application/zip` –∏ —Ç.–ø.
     * @see Mime —Ç–∏–ø—ã: https://en.wikipedia.org/wiki/Media_type
     */
    static public function save(data:Dynamic, name:String = "data", type:String = null):Void {
        var file = new Blob([data], {type: type});

        // IE10+
        if (untyped Browser.window.navigator.msSaveOrOpenBlob) {
            untyped Browser.window.navigator.msSaveOrOpenBlob(file, filename);
            return;
        }

        // –î—Ä—É–≥–∏–µ:
        var url = URL.createObjectURL(file);
        var a = Browser.document.createAnchorElement();
        a.href = url;
        a.download = name;
        Browser.document.body.appendChild(a);
        a.click();

        Browser.window.setTimeout(function() {
            Browser.document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 0);
    }
}